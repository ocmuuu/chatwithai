import { DataService } from '../services/DataService';
import { AIService } from '../services/AIService';
import { ChatSession, ChatMessage, CreateMessageParams } from '../models/ChatModels';
import { InitData } from '../setups/InitData';
import { EnhancedMarkdownText } from '../utils/MarkdownItRenderer';
import PreferencesUtil from '../utils/PreferencesUtil';
import router from '@ohos.router';
import { AIProvider, DEFAULT_PROVIDERS, DEFAULT_MODELS, getProviderModels, ProviderConfig, ModelConfig } from '../setups/DefaultConfig';

@Entry
@Component
struct Index {
  // å½“å‰é€‰ä¸­çš„ä¼šè¯ID
  @State currentSessionId: string = '';
  // ç”¨æˆ·è¾“å…¥çš„æ¶ˆæ¯
  @State inputMessage: string = '';
  // ç¬¬ä¸€æ æŠ˜å çŠ¶æ€
  @State isFirstColumnCollapsed: boolean = false;
  // ç¬¬ä¸€æ å®½åº¦
  @State firstColumnWidth: number = 280;
  // æ‹–æ‹½çŠ¶æ€
  @State isDragging: boolean = false;
  // æ‹–æ‹½å¼€å§‹æ—¶çš„å®½åº¦
  private dragStartWidth: number = 0;
  // æ•°æ®æœåŠ¡å®ä¾‹
  private dataService = DataService.getInstance();
  // AI æœåŠ¡å®ä¾‹
  private aiService = AIService.getInstance();
  // å¯¹è¯ä¼šè¯åˆ—è¡¨æ•°æ®
  @State chatSessions: ChatSession[] = [];
  // å½“å‰ä¼šè¯çš„æ¶ˆæ¯åˆ—è¡¨
  @State currentMessages: ChatMessage[] = [];
  // æ¶ˆæ¯åˆ—è¡¨æ»šåŠ¨æ§åˆ¶å™¨
  private messageListScroller = new Scroller();
  // æœ¬åœ°ä¸‹æ‹‰èœå•çŠ¶æ€
  @State showProviderMenu: boolean = false;
  @State showModelMenu: boolean = false;
  // ä¸‹æ‹‰èœå•å±•å¼€æ—¶éšè—è¾“å…¥æ¡†
  @State @Watch('onHideInputChange') hideInput: boolean = false;
  // å½“å‰ä¿å­˜çš„AIå¹³å°å’Œæ¨¡å‹ï¼ˆç”¨äºä¼ é€’ç»™PlatformModelSelectorï¼‰
  @State savedAiProvider: string = 'deepseek';
  @State savedAiModel: string = 'deepseek-chat';
  // åŠ è½½æ¶ˆæ¯æ—¶çš„å®šæ—¶å™¨ID
  private loadingTimerId: number | undefined;

  // ç›‘å¬ä¸‹æ‹‰èœå•çŠ¶æ€å˜åŒ–ï¼Œè§¦å‘æ»šåŠ¨
  onHideInputChange(newVal: boolean, oldVal: boolean) {
    if (newVal !== oldVal) {
      if (newVal) {
        console.info('ä¸‹æ‹‰èœå•å±•å¼€ï¼Œæ»šåŠ¨åˆ°åº•éƒ¨ç¡®ä¿å¯è§æ€§');
        // èœå•å±•å¼€æ—¶ç«‹å³æ»šåŠ¨ï¼Œå»¶è¿Ÿè¾ƒçŸ­
        const delays: number[] = [50, 150, 300, 600, 1000];
        delays.forEach(d => {
          setTimeout(() => {
            console.info(`èœå•å±•å¼€ - å»¶è¿Ÿ ${d}ms åå°è¯•æ»šåŠ¨åˆ°åº•éƒ¨`);
            this.scrollToBottom();
          }, d);
        });
      } else {
        console.info('ä¸‹æ‹‰èœå•å…³é—­ï¼Œæ¢å¤æ»šåŠ¨ä½ç½®');
        // èœå•å…³é—­æ—¶éœ€è¦æ›´å¤šæ—¶é—´ç­‰å¾…å¸ƒå±€æ¢å¤
        const delays: number[] = [50, 150, 300, 600, 1000];
        delays.forEach(d => {
          setTimeout(() => {
            console.info(`èœå•å…³é—­ - å»¶è¿Ÿ ${d}ms åå°è¯•æ»šåŠ¨åˆ°åº•éƒ¨`);
            this.scrollToBottom();
          }, d);
        });
      }
    }
  }

  // ç»„ä»¶åˆå§‹åŒ–
  async aboutToAppear() {
    try {
      // åˆå§‹åŒ–é¦–é€‰é¡¹
      await PreferencesUtil.init(getContext(this));
      
      // åŠ è½½ä¿å­˜çš„ç•Œé¢çŠ¶æ€
      this.isFirstColumnCollapsed = await PreferencesUtil.getFirstColumnCollapseState();
      this.firstColumnWidth = await PreferencesUtil.getFirstColumnWidth();
      const savedSessionId = await PreferencesUtil.getSelectedSessionId();
      
      // åˆå§‹åŒ–æ•°æ®åº“
      await this.dataService.initialize(getContext(this));
      // åˆå§‹åŒ– AI æœåŠ¡
      await this.aiService.initialize(getContext(this));
      
      // ä»é¦–é€‰é¡¹åŠ è½½ä¿å­˜çš„AIå¹³å°å’Œæ¨¡å‹é€‰æ‹©
      console.info('=== å¼€å§‹åŠ è½½AIè®¾ç½® ===');
      const savedProvider = await PreferencesUtil.getCurrentAiProvider();
      const savedModel = await PreferencesUtil.getCurrentAiModel();
      console.info('ä»é¦–é€‰é¡¹è¯»å– - å¹³å°:', savedProvider, 'æ¨¡å‹:', savedModel);
      
      // è®¾ç½®AIå¹³å°å’Œæ¨¡å‹
      this.aiService.setCurrentProvider(savedProvider);
      this.aiService.setCurrentModel(savedModel);
      console.info('è®¾ç½®AIæœåŠ¡ - å¹³å°:', savedProvider, 'æ¨¡å‹:', savedModel);
      
      // æ›´æ–°çŠ¶æ€å˜é‡ï¼Œç”¨äºä¼ é€’ç»™PlatformModelSelector
      this.savedAiProvider = savedProvider;
      this.savedAiModel = savedModel;
      console.info('æ›´æ–°çŠ¶æ€å˜é‡ - å¹³å°:', this.savedAiProvider, 'æ¨¡å‹:', this.savedAiModel);
      
      console.info('=== AIè®¾ç½®åŠ è½½å®Œæˆ ===');
      
      // åŠ è½½ä¼šè¯åˆ—è¡¨
      await this.loadSessions();
      
      // æ¢å¤é€‰ä¸­çš„ä¼šè¯æˆ–é€‰æ‹©ç¬¬ä¸€ä¸ª
      if (savedSessionId && this.chatSessions.find(session => session.id === savedSessionId)) {
        await this.switchSession(savedSessionId);
      } else if (this.chatSessions.length > 0) {
        await this.switchSession(this.chatSessions[0].id);
      }
    } catch (error) {
      console.error('åˆå§‹åŒ–å¤±è´¥:', error);
    }
  }

  // åŠ è½½ä¼šè¯åˆ—è¡¨
  async loadSessions() {
    try {
      const result = await this.dataService.getAllSessions({
        orderBy: 'updated_at',
        orderDirection: 'DESC'
      });
      this.chatSessions = result.data;
    } catch (error) {
      console.error('åŠ è½½ä¼šè¯åˆ—è¡¨å¤±è´¥:', error);
    }
  }

  // åŠ è½½å½“å‰ä¼šè¯çš„æ¶ˆæ¯
  async loadCurrentMessages() {
    if (!this.currentSessionId) {
      return;
    }
    
    try {
      const result = await this.dataService.getMessagesBySessionId(this.currentSessionId, {
        orderBy: 'timestamp',
        orderDirection: 'ASC'
      });
      this.currentMessages = result.data;
      
      // åŠ è½½æ¶ˆæ¯åæ»šåŠ¨åˆ°åº•éƒ¨
      if (this.currentMessages.length > 0) {
        setTimeout(() => {
          this.scrollToBottom();
        }, 200); // ç»™æ›´å¤šæ—¶é—´è®©UIå®Œå…¨æ¸²æŸ“
      }
    } catch (error) {
      console.error('åŠ è½½æ¶ˆæ¯å¤±è´¥:', error);
    }
  }

  // å‘é€æ¶ˆæ¯
  async sendMessage() {
    if (this.inputMessage.trim() === '' || !this.currentSessionId) {
      return;
    }
    
    const userContent = this.inputMessage;
    this.inputMessage = '';

    try {
      // åˆ›å»ºç”¨æˆ·æ¶ˆæ¯
      const userMessage = await this.dataService.createMessage({
        sessionId: this.currentSessionId,
        role: 'user',
        content: userContent
      });

      // æ›´æ–°UI
      this.currentMessages.push(userMessage);
      
      // æ»šåŠ¨åˆ°åº•éƒ¨æ˜¾ç¤ºæ–°æ¶ˆæ¯
      this.scrollToBottom();

      // åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„åŠ è½½æ¶ˆæ¯
      const loadingMessage: ChatMessage = {
        id: 'loading_' + Date.now(),
        sessionId: this.currentSessionId,
        role: 'assistant',
        content: '0',
        timestamp: Date.now(),
        wordCount: 0,
        tokenCount: 0,
        generating: true,
        aiProvider: this.aiService.getCurrentProvider(),
        model: this.aiService.getCurrentModel()
      };

      // å…ˆæ¨å…¥æ•°ç»„ï¼Œå†å¼€å§‹è®¡æ—¶ï¼Œç¡®ä¿ç¬¬ä¸€ç§’èƒ½æ‰¾åˆ°æ¶ˆæ¯
      this.currentMessages.push(loadingMessage);
      
      // å¯åŠ¨è¯»ç§’å®šæ—¶å™¨ï¼Œæ›´æ–° loadingMessage.content
      const loadingStart = Date.now();
      const updateLoading = () => {
        const idx = this.currentMessages.findIndex(m => m.id === loadingMessage.id);
        if (idx !== -1) {
          const elapsed = Math.floor((Date.now() - loadingStart) / 1000);
          this.currentMessages[idx].content = `æ€è€ƒ ${elapsed} ç§’`;
          // è§¦å‘ UI æ›´æ–°
          this.currentMessages = [...this.currentMessages];
        }
      };
      updateLoading();
      this.loadingTimerId = setInterval(updateLoading, 1000);
      
      // æ»šåŠ¨åˆ°åº•éƒ¨æ˜¾ç¤ºåŠ è½½æ¶ˆæ¯
      this.scrollToBottom();

      // è°ƒç”¨ AI æœåŠ¡è·å–å›å¤
      try {
        console.info('å¼€å§‹è°ƒç”¨ AI æœåŠ¡...');
        const aiReply = await this.aiService.sendMessage(this.currentMessages.slice(0, -1), userContent);
        console.info('AI æœåŠ¡å›å¤:', aiReply);

        // ç§»é™¤åŠ è½½æ¶ˆæ¯
        const loadingIndex = this.currentMessages.findIndex(msg => msg.id === loadingMessage.id);
        if (loadingIndex !== -1) {
          this.currentMessages.splice(loadingIndex, 1);
        }
        // æ¸…é™¤å®šæ—¶å™¨
        if (this.loadingTimerId) {
          clearInterval(this.loadingTimerId);
          this.loadingTimerId = undefined;
        }

        // åˆ›å»ºçœŸå®çš„AIå›å¤æ¶ˆæ¯
        const aiMessage = await this.dataService.createMessage({
          sessionId: this.currentSessionId,
          role: 'assistant',
          content: aiReply
        });
        
        // è®°å½•ä½¿ç”¨çš„AIå¹³å°å’Œæ¨¡å‹ä¿¡æ¯å¹¶å†™å›æ•°æ®åº“
        const provider = this.aiService.getCurrentProvider();
        const model = this.aiService.getCurrentModel();
        aiMessage.aiProvider = provider;
        aiMessage.model = model;
        // æŒä¹…åŒ–åˆ°æ•°æ®åº“
        await this.dataService.updateMessage(aiMessage.id, { aiProvider: provider, model: model });
        
        this.currentMessages.push(aiMessage);
        
        // æ»šåŠ¨åˆ°åº•éƒ¨æ˜¾ç¤ºAIå›å¤
        this.scrollToBottom();

        // å¦‚æœä¼šè¯æ ‡é¢˜ä»ä¸ºé»˜è®¤å€¼ï¼Œåˆ™å°è¯•è‡ªåŠ¨ç”Ÿæˆæ ‡é¢˜
        const currentSession = this.chatSessions.find(s => s.id === this.currentSessionId);
        if (currentSession && currentSession.name === 'æ–°å¯¹è¯') {
          try {
            const newTitle = await this.aiService.generateTitle(userContent, aiReply);
            if (newTitle && newTitle.trim().length > 0) {
              await this.dataService.updateSession(this.currentSessionId, { name: newTitle });
              currentSession.name = newTitle;
              // è§¦å‘UIæ›´æ–°
              this.chatSessions = [...this.chatSessions];
              console.info('è‡ªåŠ¨ç”Ÿæˆå¹¶æ›´æ–°ä¼šè¯æ ‡é¢˜:', newTitle);
            }
          } catch (titleError) {
            console.error('è‡ªåŠ¨ç”Ÿæˆæ ‡é¢˜å¤±è´¥:', titleError);
          }
        }

      } catch (aiError) {
        console.error('AI æœåŠ¡è°ƒç”¨å¤±è´¥:', aiError);
        
        // ç§»é™¤åŠ è½½æ¶ˆæ¯
        const loadingIndex = this.currentMessages.findIndex(msg => msg.id === loadingMessage.id);
        if (loadingIndex !== -1) {
          this.currentMessages.splice(loadingIndex, 1);
        }
        // æ¸…é™¤å®šæ—¶å™¨
        if (this.loadingTimerId) {
          clearInterval(this.loadingTimerId);
          this.loadingTimerId = undefined;
        }

        // å®‰å…¨åœ°è·å–é”™è¯¯æ¶ˆæ¯
        const errorMsg = (aiError instanceof Error) ? aiError.message : 'æœªçŸ¥é”™è¯¯';

        // åˆ›å»ºé”™è¯¯å›å¤æ¶ˆæ¯
        const errorMessage = await this.dataService.createMessage({
          sessionId: this.currentSessionId,
          role: 'assistant',
          content: `æŠ±æ­‰ï¼Œæˆ‘æš‚æ—¶æ— æ³•å›å¤æ‚¨çš„æ¶ˆæ¯ã€‚é”™è¯¯ä¿¡æ¯ï¼š${errorMsg}`
        });
        
        const errProvider = this.aiService.getCurrentProvider();
        const errModel = this.aiService.getCurrentModel();
        errorMessage.aiProvider = errProvider;
        errorMessage.model = errModel;
        await this.dataService.updateMessage(errorMessage.id, { aiProvider: errProvider, model: errModel });
        
        this.currentMessages.push(errorMessage);
        
        // æ»šåŠ¨åˆ°åº•éƒ¨æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
        this.scrollToBottom();
      }

    } catch (error) {
      console.error('å‘é€æ¶ˆæ¯å¤±è´¥:', error);
    }
  }

  // åˆ‡æ¢ä¼šè¯
  async switchSession(sessionId: string) {
    this.currentSessionId = sessionId;
    await this.loadCurrentMessages();
    
    // ä¿å­˜é€‰ä¸­çš„ä¼šè¯ID
    PreferencesUtil.saveSelectedSessionIdSync(sessionId);
  }

  // åˆ‡æ¢ç¬¬ä¸€æ æŠ˜å çŠ¶æ€
  toggleFirstColumn() {
    this.isFirstColumnCollapsed = !this.isFirstColumnCollapsed;
    
    // ä¿å­˜æŠ˜å çŠ¶æ€
    PreferencesUtil.saveFirstColumnCollapseStateSync(this.isFirstColumnCollapsed);
    
    console.info('ç¬¬ä¸€æ æŠ˜å çŠ¶æ€:', this.isFirstColumnCollapsed);
  }

  // åŒå‡»é‡ç½®å®½åº¦åˆ°é»˜è®¤å€¼
  resetColumnWidth() {
    this.firstColumnWidth = 280; // é»˜è®¤å®½åº¦
    PreferencesUtil.saveFirstColumnWidthSync(this.firstColumnWidth);
    console.info('ç¬¬ä¸€æ å®½åº¦å·²é‡ç½®ä¸ºé»˜è®¤å€¼:', this.firstColumnWidth);
  }



  // åˆ›å»ºæ–°ä¼šè¯
  async createNewSession() {
    try {
      const newSession = await this.dataService.createSession({
        name: 'æ–°å¯¹è¯',
        type: 'chat'
      });
      
      // é‡æ–°åŠ è½½ä¼šè¯åˆ—è¡¨
      await this.loadSessions();
      
      // åˆ‡æ¢åˆ°æ–°ä¼šè¯
      await this.switchSession(newSession.id);
    } catch (error) {
      console.error('åˆ›å»ºæ–°ä¼šè¯å¤±è´¥:', error);
    }
  }

  // é‡ç½®åº”ç”¨æ•°æ®ï¼ˆå¼€å‘æµ‹è¯•ç”¨ï¼‰
  async resetAppData() {
    try {
      console.info('=== å¼€å§‹é‡ç½®åº”ç”¨æ•°æ® ===');
      
      // é‡ç½®æ•°æ®
      await InitData.resetAppData(getContext(this));
      
      // é‡ç½® DataService çŠ¶æ€å¹¶é‡æ–°åˆå§‹åŒ–
      this.dataService = DataService.getInstance();
      this.dataService.resetForTesting();
      console.info('é‡æ–°åˆå§‹åŒ– DataService...');
      await this.dataService.initialize(getContext(this));
      
      // é‡æ–°åˆå§‹åŒ– AI æœåŠ¡
      this.aiService = AIService.getInstance();
      console.info('é‡æ–°åˆå§‹åŒ– AIService...');
      await this.aiService.initialize(getContext(this));
      
      console.info('é‡æ–°åŠ è½½ä¼šè¯åˆ—è¡¨...');
      // é‡æ–°åŠ è½½æ•°æ®
      await this.loadSessions();
      console.info(`åŠ è½½åˆ° ${this.chatSessions.length} ä¸ªä¼šè¯`);
      
      // å¦‚æœæœ‰ä¼šè¯ï¼Œé€‰æ‹©ç¬¬ä¸€ä¸ª
      if (this.chatSessions.length > 0) {
        console.info('åˆ‡æ¢åˆ°ç¬¬ä¸€ä¸ªä¼šè¯:', this.chatSessions[0].name);
        await this.switchSession(this.chatSessions[0].id);
        console.info(`å½“å‰ä¼šè¯æœ‰ ${this.currentMessages.length} æ¡æ¶ˆæ¯`);
      } else {
        console.warn('æ²¡æœ‰æ‰¾åˆ°ä»»ä½•ä¼šè¯');
        this.currentSessionId = '';
        this.currentMessages = [];
      }
      
      console.info('=== åº”ç”¨æ•°æ®é‡ç½®å®Œæˆ ===');
    } catch (error) {
      console.error('é‡ç½®åº”ç”¨æ•°æ®å¤±è´¥:', error);
    }
  }

  // æ ¼å¼åŒ–æ—¶é—´æˆ³
  formatTimestamp(timestamp: number): string {
    const date = new Date(timestamp);
    const now = new Date();
    const diff = now.getTime() - date.getTime();
    
    if (diff < 60000) { // 1åˆ†é’Ÿå†…
      return 'åˆšåˆš';
    } else if (diff < 3600000) { // 1å°æ—¶å†…
      return `${Math.floor(diff / 60000)}åˆ†é’Ÿå‰`;
    } else if (diff < 86400000) { // 1å¤©å†…
      return `${Math.floor(diff / 3600000)}å°æ—¶å‰`;
    } else {
      return `${Math.floor(diff / 86400000)}å¤©å‰`;
    }
  }

  // å¤„ç†å¹³å°å˜åŒ–
  onProviderChange(provider: AIProvider) {
    console.info('=== å¤„ç†å¹³å°å˜åŒ– ===');
    console.info('æ–°å¹³å°:', provider);
    const providerString = provider.toString();
    
    // è®¾ç½®AIæœåŠ¡
    this.aiService.setCurrentProvider(providerString);
    console.info('AIæœåŠ¡å¹³å°å·²è®¾ç½®ä¸º:', providerString);
    
    // æ›´æ–°çŠ¶æ€å˜é‡
    this.savedAiProvider = providerString;
    console.info('çŠ¶æ€å˜é‡å·²æ›´æ–° - savedAiProvider:', this.savedAiProvider);
    
    // ç«‹å³åŒæ­¥ä¿å­˜ï¼Œé¿å…åº”ç”¨é€€å‡ºå‰æœªå®Œæˆå†™å…¥
    PreferencesUtil.saveCurrentAiProviderSync(providerString);
    console.info('å¹³å°åŒæ­¥ä¿å­˜å®Œæˆ:', providerString);
    
    // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ å¹³å°åˆ‡æ¢çš„ç”¨æˆ·æç¤º
    // æ¯”å¦‚æ˜¾ç¤ºToastæç¤ºç”¨æˆ·æ˜¯å¦å·²é…ç½®APIå¯†é’¥
  }

  // å¤„ç†æ¨¡å‹å˜åŒ–
  onModelChange(model: string) {
    console.info('=== å¤„ç†æ¨¡å‹å˜åŒ– ===');
    console.info('æ–°æ¨¡å‹:', model);
    
    // è®¾ç½®AIæœåŠ¡
    this.aiService.setCurrentModel(model);
    console.info('AIæœåŠ¡æ¨¡å‹å·²è®¾ç½®ä¸º:', model);
    
    // æ›´æ–°çŠ¶æ€å˜é‡
    this.savedAiModel = model;
    console.info('çŠ¶æ€å˜é‡å·²æ›´æ–° - savedAiModel:', this.savedAiModel);
    
    // ä½¿ç”¨åŒæ­¥æ–¹æ³•ç«‹å³æŒä¹…åŒ–
    PreferencesUtil.saveCurrentAiModelSync(model);
    console.info('æ¨¡å‹åŒæ­¥ä¿å­˜å®Œæˆ:', model);
  }

  // è·å–å¹³å°å¯¹åº”çš„å›¾æ ‡èµ„æº
  private getPlatformIcon(provider: string): Resource {
    switch (provider) {
      case 'openai':
        return $r('app.media.openai');
      case 'azure':
        return $r('app.media.azure');
      case 'claude':
        return $r('app.media.claude');
      case 'gemini':
        return $r('app.media.gemini');
      case 'deepseek':
        return $r('app.media.deepseek');
      case 'siliconflow':
        return $r('app.media.siliconflow');
      case 'volcengine':
        return $r('app.media.volcengine');
      case 'xAI':
        return $r('app.media.xAI');
      case 'groq':
        return $r('app.media.groq');
      case 'chatglm-6b':
        return $r('app.media.chatglm');
      case 'ollama':
        return $r('app.media.ollama');
      case 'lm-studio':
        return $r('app.media.lmstudio');
      case 'perplexity':
        return $r('app.media.perplexity');
      case 'local':
        return $r('app.media.icon');
      default:
        return $r('app.media.deepseek'); // é»˜è®¤ä½¿ç”¨DeepSeekå›¾æ ‡
    }
  }

  // å…³é—­ä¸‹æ‹‰èœå•
  private closeDropdownMenus() {
    this.showProviderMenu = false;
    this.showModelMenu = false;
    this.hideInput = false;
  }

  // è·å–å½“å‰é€‰ä¸­çš„æä¾›å•†ä¿¡æ¯
  private getCurrentProviderInfo(): ProviderConfig | undefined {
    return DEFAULT_PROVIDERS.find(p => p.id === this.savedAiProvider);
  }

  // è·å–å½“å‰æä¾›å•†æ”¯æŒçš„æ¨¡å‹
  private getAvailableModels(): ModelConfig[] {
    return getProviderModels(this.savedAiProvider as AIProvider);
  }

  // è·å–å½“å‰é€‰ä¸­çš„æ¨¡å‹ä¿¡æ¯
  private getCurrentModelInfo(): ModelConfig | undefined {
    return DEFAULT_MODELS.find(m => m.id === this.savedAiModel && m.provider === this.savedAiProvider);
  }

  // æ»šåŠ¨åˆ°æ¶ˆæ¯åˆ—è¡¨åº•éƒ¨
  private scrollToBottom() {
    try {
      if (this.currentMessages.length > 0) {
        // ä½¿ç”¨å¤šç§æ»šåŠ¨æ–¹æ³•ç¡®ä¿æˆåŠŸ
        try {
          // æ–¹æ³•1ï¼šç›´æ¥æ»šåŠ¨åˆ°åº•éƒ¨è¾¹ç¼˜
          this.messageListScroller.scrollEdge(Edge.Bottom);
          console.info('ä½¿ç”¨scrollEdgeæ–¹æ³•æ»šåŠ¨æˆåŠŸ');
        } catch (scrollError) {
          console.warn('scrollEdgeå¤±è´¥ï¼Œå°è¯•å…¶ä»–æ–¹æ³•:', scrollError);
          try {
            // æ–¹æ³•2ï¼šæ»šåŠ¨åˆ°æœ€åä¸€ä¸ªå…ƒç´ 
            this.messageListScroller.scrollToIndex(this.currentMessages.length - 1, true);
            console.info('ä½¿ç”¨scrollToIndexæ–¹æ³•æ»šåŠ¨æˆåŠŸ');
          } catch (indexScrollError) {
            console.warn('scrollToIndexå¤±è´¥ï¼Œå°è¯•scrollToæ–¹æ³•:', indexScrollError);
            try {
              // æ–¹æ³•3ï¼šæ»šåŠ¨åˆ°ä¸€ä¸ªå¾ˆå¤§çš„ä½ç½®
              this.messageListScroller.scrollTo({ xOffset: 0, yOffset: 999999 });
              console.info('ä½¿ç”¨scrollToæ–¹æ³•æ»šåŠ¨æˆåŠŸ');
            } catch (scrollToError) {
              console.error('æ‰€æœ‰æ»šåŠ¨æ–¹æ³•éƒ½å¤±è´¥äº†:', scrollToError);
            }
          }
        }
      }
    } catch (error) {
      console.error('æ»šåŠ¨åˆ°åº•éƒ¨å¤±è´¥:', error);
    }
  }

  build() {
    Row() {
      // å·¦ä¾§å¯¹è¯åˆ—è¡¨
      Column() {
        // æ ‡é¢˜æ 
        Row() {
          Text('å¯¹è¯åˆ—è¡¨')
            .fontSize(18)
            .fontWeight(FontWeight.Bold)
            .fontColor('#333333')
          
          Blank()
          
          // æ–°å»ºå¯¹è¯æŒ‰é’®
          Button() {
            Image($r('app.media.new'))
              .width(20)
              .height(20)
          }
          .width(32)
          .height(32)
          .backgroundColor('#fff')
          .borderRadius(16)
          .onClick(() => {
            this.createNewSession();
          })
        }
        .width('100%')
        .height(60)
        .padding({ left: 16, right: 16 })
        .justifyContent(FlexAlign.SpaceBetween)
        .alignItems(VerticalAlign.Center)
        .backgroundColor('#F5F5F5')
        
        Divider()
          .color('#E0E0E0')
          .strokeWidth(1)
        
        // å¯¹è¯ä¼šè¯åˆ—è¡¨
        List() {
          ForEach(this.chatSessions, (session: ChatSession) => {
            ListItem() {
              Column() {
                Row() {
                  Text(session.name)
                    .fontSize(16)
                    .fontWeight(FontWeight.Medium)
                    .fontColor(this.currentSessionId === session.id ? '#007AFF' : '#333333')
                    .maxLines(1)
                    .textOverflow({ overflow: TextOverflow.Ellipsis })
                  
                  Blank()
                  
                  Text(this.formatTimestamp(session.updatedAt))
                    .fontSize(12)
                    .fontColor('#999999')
                    .width(64)
                    .textAlign(TextAlign.End)
                }
                .width('100%')
                .margin({ bottom: 4 })
                
                Text(session.threadName || 'æš‚æ— æ¶ˆæ¯')
                  .fontSize(14)
                  .fontColor('#666666')
                  .maxLines(1)
                  .textOverflow({ overflow: TextOverflow.Ellipsis })
                  .width('100%')
              }
              .width('100%')
              .padding({ left: 16, right: 16, top: 12, bottom: 12 })
              .backgroundColor(this.currentSessionId === session.id ? '#E3F2FD' : '#FFFFFF')
              .alignItems(HorizontalAlign.Start)
            }
            .onClick(() => {
              // å…³é—­ä¸‹æ‹‰èœå•
              this.closeDropdownMenus();
              this.switchSession(session.id);
            })
          })
        }
        .layoutWeight(1)
        .width('100%')
        .divider({
          strokeWidth: 1,
          color: '#F0F0F0'
        })
        
        // åº•éƒ¨å®½åº¦æ˜¾ç¤ºï¼ˆä»…åœ¨æ‹–æ‹½æ—¶æ˜¾ç¤ºï¼‰
        if (this.isDragging) {
          Row() {
            Text(`å®½åº¦: ${Math.round(this.firstColumnWidth)}px`)
              .fontSize(11)
              .fontColor('#666666')
              .padding({ left: 8, right: 8, top: 4, bottom: 4 })
              .backgroundColor('#F0F0F0')
              .borderRadius(4)
          }
          .width('100%')
          .height(28)
          .justifyContent(FlexAlign.Center)
          .alignItems(VerticalAlign.Center)
          .backgroundColor('#FAFAFA')
        }
      }
      .width(this.isFirstColumnCollapsed ? 0 : this.firstColumnWidth)
      .height('100%')
      .backgroundColor('#FAFAFA')
      .visibility(this.isFirstColumnCollapsed ? Visibility.None : Visibility.Visible)
      
      // å¯æ‹–æ‹½çš„åˆ†å‰²çº¿æ‰‹æŸ„
      if (!this.isFirstColumnCollapsed) {
        Stack() {
          // èƒŒæ™¯åŒºåŸŸ
          Column()
            .width(6)
            .height('100%')
            .backgroundColor('#F8F9FA')
          
          // åˆ†å‰²çº¿
          Column()
            .width(1)
            .height('100%')
            .backgroundColor(this.isDragging ? '#007AFF' : '#E0E0E0')
          
          // æ‹–æ‹½æŒ‡ç¤ºå™¨ï¼ˆä¸­é—´çš„å°ç«–æ¡ï¼‰
          Column() {
            Column()
              .width(3)
              .height(40)
              .backgroundColor(this.isDragging ? '#007AFF' : '#E0E0E0')
              .borderRadius(1.5)
              .opacity(this.isDragging ? 0.8 : 0.4)
              .animation({
                duration: 200,
                curve: Curve.EaseInOut
              })
          }
          .justifyContent(FlexAlign.Center)
          .height('100%')
        }
        .width(6)
        .height('100%')
        .gesture(
          // æ‹–æ‹½æ‰‹åŠ¿ - è°ƒæ•´å®½åº¦
          GestureGroup(GestureMode.Exclusive,
            PanGesture({ fingers: 1, direction: PanDirection.Horizontal })
              .onActionStart(() => {
                this.isDragging = true;
                this.dragStartWidth = this.firstColumnWidth; // è®°å½•èµ·å§‹å®½åº¦
                console.info('å¼€å§‹æ‹–æ‹½è°ƒæ•´å®½åº¦ï¼Œèµ·å§‹å®½åº¦:', this.dragStartWidth);
              })
              .onActionUpdate((event: GestureEvent) => {
                if (!this.isFirstColumnCollapsed) {
                  // åŸºäºèµ·å§‹å®½åº¦å’Œåç§»é‡è®¡ç®—æ–°å®½åº¦
                  let newWidth = this.dragStartWidth + event.offsetX;
                  // é™åˆ¶å®½åº¦èŒƒå›´ï¼šæœ€å°180pxï¼Œæœ€å¤§500px
                  newWidth = Math.max(180, Math.min(500, newWidth));
                  this.firstColumnWidth = newWidth;
                }
              })
              .onActionEnd(() => {
                this.isDragging = false;
                // ä¿å­˜æ–°çš„å®½åº¦åˆ°æœ¬åœ°å­˜å‚¨
                PreferencesUtil.saveFirstColumnWidthSync(this.firstColumnWidth);
                console.info('æ‹–æ‹½ç»“æŸï¼Œæœ€ç»ˆå®½åº¦:', this.firstColumnWidth);
              }),
            // åŒå‡»æ‰‹åŠ¿ - é‡ç½®å®½åº¦
            TapGesture({ count: 2 })
              .onAction(() => {
                this.resetColumnWidth();
              })
          )
        )
      }
      
      // å³ä¾§å¯¹è¯åŒºåŸŸ
      Column() {
        // å¯¹è¯å†å²åŒºåŸŸ
        Column() {
          // å½“å‰ä¼šè¯æ ‡é¢˜
          Row() {
            // ç¬¬ä¸€æ æŠ˜å æŒ‰é’®
            Button() {
              Image(this.isFirstColumnCollapsed ? $r('app.media.show') : $r('app.media.hide'))
                .width(20)
                .height(20)
                .fillColor('#fff')
                .transition({
                  type: TransitionType.All,
                  scale: { x: 0.9, y: 0.9 },
                  opacity: 0.8
                })
            }
            .width(32)
            .height(32)
            .backgroundColor('#fff')
            .borderRadius(16)
            .margin({ right: 12 })
            .stateEffect(true)
            .onClick(() => {
              this.toggleFirstColumn();
            })
            .transition({
              type: TransitionType.All,
              scale: { x: 1.05, y: 1.05 }
            })
            
            Text(this.chatSessions.find(session => session.id === this.currentSessionId)?.name ?? 'æ–°å¯¹è¯')
              .fontSize(18)
              .fontWeight(FontWeight.Bold)
              .fontColor('#333333')
              .layoutWeight(1)
          }
          .width('100%')
          .height(60)
          .padding({ left: 16, right: 16 })
          .justifyContent(FlexAlign.Start)
          .alignItems(VerticalAlign.Center)
          .backgroundColor('#F8F9FA')
          .flexShrink(0)
          
          Divider()
            .color('#E0E0E0')
            .strokeWidth(1)
          
          // æ¶ˆæ¯åˆ—è¡¨
          List({ scroller: this.messageListScroller }) {
            ForEach(this.currentMessages, (message: ChatMessage, index: number) => {
              ListItem() {
                Row() {
                  if (message.role === 'user') {
                    Blank()
                    
                    Row() {
                      Column() {
                        Text(message.content)
                          .fontSize(16)
                          .fontColor('#FFFFFF')
                          .padding(12)
                          .backgroundColor('#007AFF')
                          .borderRadius(12)
                          .margin({ bottom: 4 })
                        
                        Text(this.formatTimestamp(message.timestamp))
                          .fontSize(12)
                          .fontColor('#999999')
                          .alignSelf(ItemAlign.End)
                      }
                      .alignItems(HorizontalAlign.End)
                      .layoutWeight(1)
                      
                      // ç”¨æˆ·å¤´åƒ
                      Image($r('app.media.user'))
                        .width(32)
                        .height(32)
                        .borderRadius(16)
                        .margin({ left: 8 })
                        .border({ width: 1, color: '#E0E0E0' })
                    }
                    .alignItems(VerticalAlign.Top)
                    .margin({ left: 60 })
                  } else {
                    Row() {
                      // AIå¹³å°å¤´åƒ
                      Image(this.getPlatformIcon(message.aiProvider || this.aiService.getCurrentProvider()))
                        .width(32)
                        .height(32)
                        .borderRadius(16)
                        .margin({ right: 8 })
                        .border({ width: 1, color: '#E0E0E0' })
                      
                      Column() {
                        Row() {
                          // æ ¹æ®æ¶ˆæ¯çŠ¶æ€é€‰æ‹©ä¸åŒçš„æ˜¾ç¤ºç»„ä»¶
                          if (message.generating) {
                            // åŠ è½½çŠ¶æ€æ˜¾ç¤ºç®€å•æ–‡æœ¬
                            Text(message.content)
                              .fontSize(16)
                              .fontColor('#666666')
                              .padding(12)
                              .backgroundColor('#E8F4FD')
                              .borderRadius(12)
                              .margin({ bottom: 4 })
                          } else {
                            // å®ŒæˆçŠ¶æ€æ˜¾ç¤ºå¢å¼ºç‰ˆ Markdown æ¸²æŸ“æ–‡æœ¬
                            Column() {
                              EnhancedMarkdownText({
                                content: message.content,
                                fontSize: 16,
                                fontColor: '#333333'
                              })
                            }
                            .padding(12)
                            .backgroundColor('#F1F1F1')
                            .borderRadius(12)
                            .margin({ bottom: 4 })
                            .alignItems(HorizontalAlign.Start)
                          }
                          
                          if (message.generating) {
                            // åœ¨åŠ è½½çŠ¶æ€æ—¶ï¼Œè¿™é‡Œä¸å†æ˜¾ç¤ºåŠ¨ç”»çœç•¥å·ï¼Œè€Œæ˜¯ä»…æ˜¾ç¤ºæ°”æ³¡å†…çš„å€’è®¡æ—¶
                          }
                        }
                        .alignItems(VerticalAlign.Bottom)
                        
                        Text(this.formatTimestamp(message.timestamp))
                          .fontSize(12)
                          .fontColor('#999999')
                          .alignSelf(ItemAlign.Start)
                      }
                      .alignItems(HorizontalAlign.Start)
                      .layoutWeight(1)
                    }
                    .alignItems(VerticalAlign.Top)
                    .margin({ right: 60 })
                    
                    Blank()
                  }
                }
                .width('100%')
                .padding({ left: 16, right: 16, top: 8, bottom: 8 })
              }
            })
          }
          .layoutWeight(1)
          .width('100%')
          .padding({ top: 8, bottom: 8 })
          .scrollBar(BarState.Auto)
          .edgeEffect(EdgeEffect.Spring)
        }
        .layoutWeight(1)
        .width('100%')
        .onClick(() => {
          // ç‚¹å‡»å¯¹è¯å†å²åŒºåŸŸæ—¶å…³é—­ä¸‹æ‹‰èœå•
          this.closeDropdownMenus();
        })
        
        Divider()
          .color('#E0E0E0')
          .strokeWidth(1)
        
        // AIå¹³å°ä¸æ¨¡å‹é€‰æ‹©å™¨ï¼ˆå†…åµŒï¼‰
        Column() {
          Row() {
            Text('AIå¹³å°ä¸æ¨¡å‹')
              .fontSize(14)
              .fontColor('#666666')
              .fontWeight(FontWeight.Medium)
              .width(100)
              .padding({ left: 12, right: 4 })

            // å¹³å°é€‰æ‹©æŒ‰é’®
            Button() {
              Row() {
                Text(this.getCurrentProviderInfo()?.name || 'æœªçŸ¥')
                  .fontSize(13)
                  .fontColor('#333333')
                  .layoutWeight(1)
                  .textAlign(TextAlign.Start)
                  .maxLines(1)
                  .textOverflow({ overflow: TextOverflow.Ellipsis })

                Text('â–¼')
                  .fontSize(10)
                  .fontColor('#666666')
                  .rotate({ angle: this.showProviderMenu ? 180 : 0 })
                  .animation({ duration: 200, curve: Curve.EaseInOut })
              }
              .width('100%')
              .justifyContent(FlexAlign.SpaceBetween)
              .alignItems(VerticalAlign.Center)
            }
            .width(100)
            .height(30)
            .backgroundColor('#F8F9FA')
            .borderRadius(4)
            .padding({ left: 6, right: 6 })
            .margin({ left: 8, right: 8 })
            .onClick(() => {
              this.showProviderMenu = !this.showProviderMenu;
              this.showModelMenu = false;
              this.hideInput = this.showProviderMenu || this.showModelMenu;
            })

            // æ¨¡å‹é€‰æ‹©æŒ‰é’®
            Button() {
              Row() {
                Text(this.getCurrentModelInfo()?.name || 'æœªçŸ¥')
                  .fontSize(13)
                  .fontColor('#333333')
                  .layoutWeight(1)
                  .maxLines(1)
                  .textOverflow({ overflow: TextOverflow.Ellipsis })
                  .textAlign(TextAlign.Start)

                if (this.getCurrentModelInfo() && this.getCurrentModelInfo()!.supportVision) {
                  Text('ğŸ‘ï¸').fontSize(9).margin({ right: 2 });
                }
                if (this.getCurrentModelInfo() && this.getCurrentModelInfo()!.supportTools) {
                  Text('ğŸ”§').fontSize(9).margin({ right: 2 });
                }

                if (this.getCurrentModelInfo()) {
                  Text(`${(this.getCurrentModelInfo()!.contextWindow / 1000).toFixed(0)}K`)
                    .fontSize(11)
                    .fontColor('#999999')
                    .margin({ right: 4 });
                }

                Text('â–¼')
                  .fontSize(10)
                  .fontColor('#666666')
                  .rotate({ angle: this.showModelMenu ? 180 : 0 })
                  .animation({ duration: 200, curve: Curve.EaseInOut })
              }
              .width('100%')
              .justifyContent(FlexAlign.SpaceBetween)
              .alignItems(VerticalAlign.Center)
            }
            .width(320)
            .height(30)
            .backgroundColor('#F8F9FA')
            .borderRadius(4)
            .padding({ left: 6, right: 6 })
            .onClick(() => {
              this.showModelMenu = !this.showModelMenu;
              this.showProviderMenu = false;
              this.hideInput = this.showProviderMenu || this.showModelMenu;
            })

            Blank()

            // è®¾ç½®æŒ‰é’®
            Button() {
              Image($r('app.media.setting'))
                .width(16)
                .height(16)
                .fillColor('#666666')
            }
            .width(30)
            .height(30)
            .backgroundColor('#F8F9FA')
            .borderRadius(4)
            .margin({ left: 8 })
            .onClick(() => {
              // å…³é—­ä¸‹æ‹‰èœå•
              this.showProviderMenu = false;
              this.showModelMenu = false;
              this.hideInput = false;

              // è·³è½¬åˆ°è®¾ç½®é¡µé¢
              router.pushUrl({ url: 'pages/Platform' }).catch((error: Error) => {
                console.error('è·³è½¬åˆ°è®¾ç½®é¡µé¢å¤±è´¥:', error.message);
              });
            })
          }
          .width('100%')
          .height(42)
          .alignItems(VerticalAlign.Center)
          .justifyContent(FlexAlign.Start)
          .padding({ left: 4, right: 4, top: 6, bottom: 6 })
          .backgroundColor('#FFFFFF')
          .borderRadius(4)
          .border({ width: 1, color: '#E0E0E0' })
          .onClick(() => {
            this.closeDropdownMenus();
          })

          // å¹³å°ä¸‹æ‹‰èœå•
          if (this.showProviderMenu) {
            List() {
              ForEach(DEFAULT_PROVIDERS, (provider: ProviderConfig) => {
                ListItem() {
                  Button() {
                    Row() {
                      Text(provider.name)
                        .fontSize(13)
                        .fontColor(this.savedAiProvider === provider.id ? '#007AFF' : '#333333')
                        .fontWeight(this.savedAiProvider === provider.id ? FontWeight.Medium : FontWeight.Normal)
                      Blank()
                      if (this.savedAiProvider === provider.id) {
                        Text('âœ“').fontSize(11).fontColor('#007AFF');
                      }
                    }
                    .width('100%')
                    .justifyContent(FlexAlign.SpaceBetween)
                    .alignItems(VerticalAlign.Center)
                  }
                  .width('100%')
                  .height(34)
                  .padding({ left: 10, right: 10, top: 6, bottom: 6 })
                  .backgroundColor(this.savedAiProvider === provider.id ? '#E3F2FD' : '#FFFFFF')
                  .borderRadius(4)
                  .onClick(() => {
                    if (this.savedAiProvider !== provider.id) {
                      this.onProviderChange(provider.id);
                      // åˆ‡æ¢åˆ°æ–°å¹³å°é¦–ä¸ªæ¨¡å‹
                      const models = this.getAvailableModels();
                      if (models.length > 0) {
                        this.onModelChange(models[0].id);
                      }
                    }
                    this.showProviderMenu = false;
                    this.hideInput = false;
                  })
                }
              })
            }
            .width(200)
            .height(102)
            .backgroundColor('#FFFFFF')
            .borderRadius(4)
            .border({ width: 1, color: '#E0E0E0' })
            .padding(4)
            .margin({ left: 108, top: 4, bottom: 4 })
            .scrollBar(BarState.Auto)
            .shadow({ radius: 4, color: 'rgba(0,0,0,0.1)', offsetX: 0, offsetY: 2 })
            .animation({ duration: 200, curve: Curve.EaseInOut })
          }

          // æ¨¡å‹ä¸‹æ‹‰èœå•
          if (this.showModelMenu) {
            List() {
              ForEach(this.getAvailableModels(), (model: ModelConfig) => {
                ListItem() {
                  Button() {
                    Row() {
                      Text(model.name)
                        .fontSize(13)
                        .fontColor(this.savedAiModel === model.id ? '#007AFF' : '#333333')
                        .fontWeight(this.savedAiModel === model.id ? FontWeight.Medium : FontWeight.Normal)
                        .layoutWeight(1)
                        .maxLines(1)
                        .textOverflow({ overflow: TextOverflow.Ellipsis })

                      if (model.supportVision) {
                        Text('ğŸ‘ï¸').fontSize(9).margin({ right: 4 });
                      }
                      if (model.supportTools) {
                        Text('ğŸ”§').fontSize(9).margin({ right: 4 });
                      }

                      Text(`${(model.contextWindow / 1000).toFixed(0)}K`)
                        .fontSize(10)
                        .fontColor('#999999')
                        .margin({ right: 8 });

                      if (this.savedAiModel === model.id) {
                        Text('âœ“').fontSize(11).fontColor('#007AFF');
                      }
                    }
                    .width('100%')
                    .justifyContent(FlexAlign.SpaceBetween)
                    .alignItems(VerticalAlign.Center)
                  }
                  .width('100%')
                  .height(34)
                  .backgroundColor(this.savedAiModel === model.id ? '#E3F2FD' : '#FFFFFF')
                  .borderRadius(4)
                  .padding({ left: 10, right: 10, top: 6, bottom: 6 })
                  .onClick(() => {
                    if (this.savedAiModel !== model.id) {
                      this.onModelChange(model.id);
                    }
                    this.showModelMenu = false;
                    this.hideInput = false;
                  })
                }
              })
            }
            .width(400)
            .height(102)
            .backgroundColor('#FFFFFF')
            .borderRadius(4)
            .border({ width: 1, color: '#E0E0E0' })
            .padding(4)
            .margin({ left: 216, top: 4, bottom: 4 })
            .scrollBar(BarState.Auto)
            .shadow({ radius: 4, color: 'rgba(0,0,0,0.1)', offsetX: 0, offsetY: 2 })
            .animation({ duration: 200, curve: Curve.EaseInOut })
          }
        }
        .alignItems(HorizontalAlign.Start)
        .margin({ left: 16, right: 16, top: 6, bottom: 6 })
        
        // åº•éƒ¨è¾“å…¥åŒºåŸŸ
        if (!this.hideInput) {
          Row() {
            TextArea({ placeholder: 'è¾“å…¥æ¶ˆæ¯...', text: this.inputMessage })
              .layoutWeight(1)
              .height(99)  // å›ºå®š3è¡Œé«˜åº¦
              .fontSize(16)
              .lineHeight(24)  // å¢åŠ è¡Œé—´è·ï¼Œæå‡å¯è¯»æ€§
              .backgroundColor('#F8F9FA')
              .borderRadius(12)
              .padding({ left: 16, right: 16, top: 12, bottom: 12 })
              .border({ width: 1, color: '#E0E0E0' })
              .maxLines(1024)  // æœ€å¤šæ”¯æŒ1024è¡Œ
              .onChange((value: string) => {
                this.inputMessage = value;
                // å½“ç”¨æˆ·å¼€å§‹è¾“å…¥æ—¶ï¼Œç¡®ä¿å¯ä»¥çœ‹åˆ°è¾“å…¥æ¡†
                if (value.length > 0 && this.currentMessages.length > 0) {
                  setTimeout(() => {
                    this.scrollToBottom();
                  }, 50);
                }
              })
              .onFocus(() => {
                // è¾“å…¥æ¡†è·å¾—ç„¦ç‚¹æ—¶å…³é—­ä¸‹æ‹‰èœå•
                this.closeDropdownMenus();
              })
              .onClick(() => {
                // ç‚¹å‡»è¾“å…¥æ¡†æ—¶å…³é—­ä¸‹æ‹‰èœå•
                this.closeDropdownMenus();
              })
            
            Button('å‘é€')
              .width(68)
              .height(99)  // ä¸è¾“å…¥æ¡†é«˜åº¦ä¸€è‡´
              .fontSize(16)
              .backgroundColor('#007AFF')
              .fontColor('#FFFFFF')
              .borderRadius(12)
              .margin({ left: 12 })
              .enabled(this.inputMessage.trim().length > 0)
              .opacity(this.inputMessage.trim().length > 0 ? 1 : 0.5)
              .onClick(() => {
                this.sendMessage();
              })
          }
          .width('100%')
          .padding({ left: 16, right: 16, top: 3, bottom: 8 })
          .backgroundColor('#FFFFFF')
        }
      }
      .layoutWeight(1)
      .height('100%')
      .backgroundColor('#FFFFFF')
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#FFFFFF')
  }
}